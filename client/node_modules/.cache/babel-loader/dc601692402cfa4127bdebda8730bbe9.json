{"ast":null,"code":"'use strict';\n\nvar Buffer = require('safe-buffer').Buffer;\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar exec = require('child_process').exec;\n\nvar qs = require('qs');\n\nvar crypto = require('crypto');\n\nvar hasOwn = {}.hasOwnProperty;\n\nvar isPlainObject = require('lodash.isplainobject');\n\nvar OPTIONS_KEYS = ['api_key', 'idempotency_key', 'stripe_account', 'stripe_version'];\nvar utils = module.exports = {\n  isAuthKey: function (key) {\n    return typeof key == 'string' && /^(?:[a-z]{2}_)?[A-z0-9]{32}$/.test(key);\n  },\n  isOptionsHash: function (o) {\n    return isPlainObject(o) && OPTIONS_KEYS.some(function (key) {\n      return hasOwn.call(o, key);\n    });\n  },\n\n  /**\n   * Stringifies an Object, accommodating nested objects\n   * (forming the conventional key 'parent[child]=value')\n   */\n  stringifyRequestData: function (data) {\n    return qs.stringify(data, {\n      serializeDate: function (d) {\n        return Math.floor(d.getTime() / 1000);\n      }\n    }) // Don't use strict form encoding by changing the square bracket control\n    // characters back to their literals. This is fine by the server, and\n    // makes these parameter strings easier to read.\n    .replace(/%5B/g, '[').replace(/%5D/g, ']');\n  },\n\n  /**\n   * Outputs a new function with interpolated object property values.\n   * Use like so:\n   *   var fn = makeURLInterpolator('some/url/{param1}/{param2}');\n   *   fn({ param1: 123, param2: 456 }); // => 'some/url/123/456'\n   */\n  makeURLInterpolator: function () {\n    var rc = {\n      '\\n': '\\\\n',\n      '\\\"': '\\\\\\\"',\n      '\\u2028': '\\\\u2028',\n      '\\u2029': '\\\\u2029'\n    };\n    return function makeURLInterpolator(str) {\n      var cleanString = str.replace(/[\"\\n\\r\\u2028\\u2029]/g, function ($0) {\n        return rc[$0];\n      });\n      return function (outputs) {\n        return cleanString.replace(/\\{([\\s\\S]+?)\\}/g, function ($0, $1) {\n          return encodeURIComponent(outputs[$1] || '');\n        });\n      };\n    };\n  }(),\n\n  /**\n   * Return the data argument from a list of arguments\n   */\n  getDataFromArgs: function (args) {\n    if (args.length < 1 || !isPlainObject(args[0])) {\n      return {};\n    }\n\n    if (!utils.isOptionsHash(args[0])) {\n      return args.shift();\n    }\n\n    var argKeys = Object.keys(args[0]);\n    var optionKeysInArgs = argKeys.filter(function (key) {\n      return OPTIONS_KEYS.indexOf(key) > -1;\n    }); // In some cases options may be the provided as the first argument.\n    // Here we're detecting a case where there are two distinct arguments\n    // (the first being args and the second options) and with known\n    // option keys in the first so that we can warn the user about it.\n\n    if (optionKeysInArgs.length > 0 && optionKeysInArgs.length !== argKeys.length) {\n      emitWarning('Options found in arguments (' + optionKeysInArgs.join(', ') + '). Did you mean to pass an options ' + 'object? See https://github.com/stripe/stripe-node/wiki/Passing-Options.');\n    }\n\n    return {};\n  },\n\n  /**\n   * Return the options hash from a list of arguments\n   */\n  getOptionsFromArgs: function (args) {\n    var opts = {\n      auth: null,\n      headers: {}\n    };\n\n    if (args.length > 0) {\n      var arg = args[args.length - 1];\n\n      if (utils.isAuthKey(arg)) {\n        opts.auth = args.pop();\n      } else if (utils.isOptionsHash(arg)) {\n        var params = args.pop();\n        var extraKeys = Object.keys(params).filter(function (key) {\n          return OPTIONS_KEYS.indexOf(key) == -1;\n        });\n\n        if (extraKeys.length) {\n          emitWarning('Invalid options found (' + extraKeys.join(', ') + '); ignoring.');\n        }\n\n        if (params.api_key) {\n          opts.auth = params.api_key;\n        }\n\n        if (params.idempotency_key) {\n          opts.headers['Idempotency-Key'] = params.idempotency_key;\n        }\n\n        if (params.stripe_account) {\n          opts.headers['Stripe-Account'] = params.stripe_account;\n        }\n\n        if (params.stripe_version) {\n          opts.headers['Stripe-Version'] = params.stripe_version;\n        }\n      }\n    }\n\n    return opts;\n  },\n\n  /**\n   * Provide simple \"Class\" extension mechanism\n   */\n  protoExtend: function (sub) {\n    var Super = this;\n    var Constructor = hasOwn.call(sub, 'constructor') ? sub.constructor : function () {\n      Super.apply(this, arguments);\n    }; // This initialization logic is somewhat sensitive to be compatible with\n    // divergent JS implementations like the one found in Qt. See here for more\n    // context:\n    //\n    // https://github.com/stripe/stripe-node/pull/334\n\n    Object.assign(Constructor, Super);\n    Constructor.prototype = Object.create(Super.prototype);\n    Object.assign(Constructor.prototype, sub);\n    return Constructor;\n  },\n\n  /**\n  * Secure compare, from https://github.com/freewil/scmp\n  */\n  secureCompare: function (a, b) {\n    a = Buffer.from(a);\n    b = Buffer.from(b); // return early here if buffer lengths are not equal since timingSafeEqual\n    // will throw if buffer lengths are not equal\n\n    if (a.length !== b.length) {\n      return false;\n    } // use crypto.timingSafeEqual if available (since Node.js v6.6.0),\n    // otherwise use our own scmp-internal function.\n\n\n    if (crypto.timingSafeEqual) {\n      return crypto.timingSafeEqual(a, b);\n    }\n\n    var len = a.length;\n    var result = 0;\n\n    for (var i = 0; i < len; ++i) {\n      result |= a[i] ^ b[i];\n    }\n\n    return result === 0;\n  },\n\n  /**\n  * Remove empty values from an object\n  */\n  removeEmpty: function (obj) {\n    if (typeof obj !== 'object') {\n      throw new Error('Argument must be an object');\n    }\n\n    Object.keys(obj).forEach(function (key) {\n      if (obj[key] === null || obj[key] === undefined) {\n        delete obj[key];\n      }\n    });\n    return obj;\n  },\n\n  /**\n  * Determine if file data is a derivative of EventEmitter class.\n  * https://nodejs.org/api/events.html#events_events\n  */\n  checkForStream: function (obj) {\n    if (obj.file && obj.file.data) {\n      return obj.file.data instanceof EventEmitter;\n    }\n\n    return false;\n  },\n  callbackifyPromiseWithTimeout: function (promise, callback) {\n    if (callback) {\n      // Ensure callback is called outside of promise stack.\n      return promise.then(function (res) {\n        setTimeout(function () {\n          callback(null, res);\n        }, 0);\n      }, function (err) {\n        setTimeout(function () {\n          callback(err, null);\n        }, 0);\n      });\n    }\n\n    return promise;\n  },\n\n  /**\n   * Allow for special capitalization cases (such as OAuth)\n   */\n  pascalToCamelCase: function (name) {\n    if (name === 'OAuth') {\n      return 'oauth';\n    } else {\n      return name[0].toLowerCase() + name.substring(1);\n    }\n  },\n  emitWarning: emitWarning,\n\n  /**\n   * Node's built in `exec` function sometimes throws outright,\n   * and sometimes has a callback with an error,\n   * depending on the type of error.\n   *\n   * This unifies that interface.\n   */\n  safeExec: function safeExec(cmd, cb) {\n    try {\n      utils._exec(cmd, cb);\n    } catch (e) {\n      cb(e, null);\n    }\n  },\n  // For mocking in tests.\n  _exec: exec,\n  isObject: function isObject(obj) {\n    var type = typeof obj;\n    return (type === 'function' || type === 'object') && !!obj;\n  },\n  // For use in multipart requests\n  flattenAndStringify: function flattenAndStringify(data) {\n    var result = {};\n\n    function step(obj, prevKey) {\n      Object.keys(obj).forEach(function (key) {\n        var value = obj[key];\n        var newKey = prevKey ? `${prevKey}[${key}]` : key;\n\n        if (utils.isObject(value)) {\n          if (!Buffer.isBuffer(value) && !value.hasOwnProperty('data')) {\n            // Non-buffer non-file Objects are recursively flattened\n            return step(value, newKey);\n          } else {\n            // Buffers and file objects are stored without modification\n            result[newKey] = value;\n          }\n        } else {\n          // Primitives are converted to strings\n          result[newKey] = String(value);\n        }\n      });\n    }\n\n    step(data);\n    return result;\n  }\n};\n\nfunction emitWarning(warning) {\n  if (typeof process.emitWarning !== 'function') {\n    return console.warn('Stripe: ' + warning);\n    /* eslint-disable-line no-console */\n  }\n\n  return process.emitWarning(warning, 'Stripe');\n}","map":{"version":3,"sources":["C:/Developing/portfolios/bnb_clone/node_modules/stripe/lib/utils.js"],"names":["Buffer","require","EventEmitter","exec","qs","crypto","hasOwn","hasOwnProperty","isPlainObject","OPTIONS_KEYS","utils","module","exports","isAuthKey","key","test","isOptionsHash","o","some","call","stringifyRequestData","data","stringify","serializeDate","d","Math","floor","getTime","replace","makeURLInterpolator","rc","str","cleanString","$0","outputs","$1","encodeURIComponent","getDataFromArgs","args","length","shift","argKeys","Object","keys","optionKeysInArgs","filter","indexOf","emitWarning","join","getOptionsFromArgs","opts","auth","headers","arg","pop","params","extraKeys","api_key","idempotency_key","stripe_account","stripe_version","protoExtend","sub","Super","Constructor","constructor","apply","arguments","assign","prototype","create","secureCompare","a","b","from","timingSafeEqual","len","result","i","removeEmpty","obj","Error","forEach","undefined","checkForStream","file","callbackifyPromiseWithTimeout","promise","callback","then","res","setTimeout","err","pascalToCamelCase","name","toLowerCase","substring","safeExec","cmd","cb","_exec","e","isObject","type","flattenAndStringify","step","prevKey","value","newKey","isBuffer","String","warning","process","console","warn"],"mappings":"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","sourcesContent":["'use strict';\n\nvar Buffer = require('safe-buffer').Buffer;\nvar EventEmitter = require('events').EventEmitter;\nvar exec = require('child_process').exec;\nvar qs = require('qs');\nvar crypto = require('crypto');\n\nvar hasOwn = {}.hasOwnProperty;\nvar isPlainObject = require('lodash.isplainobject');\n\nvar OPTIONS_KEYS = ['api_key', 'idempotency_key', 'stripe_account', 'stripe_version'];\n\nvar utils = module.exports = {\n\n  isAuthKey: function(key) {\n    return typeof key == 'string' && /^(?:[a-z]{2}_)?[A-z0-9]{32}$/.test(key);\n  },\n\n  isOptionsHash: function(o) {\n    return isPlainObject(o) && OPTIONS_KEYS.some(function(key) {\n      return hasOwn.call(o, key);\n    });\n  },\n\n  /**\n   * Stringifies an Object, accommodating nested objects\n   * (forming the conventional key 'parent[child]=value')\n   */\n  stringifyRequestData: function(data) {\n    return qs.stringify(data, {serializeDate: function (d) { return Math.floor(d.getTime() / 1000); }})\n      // Don't use strict form encoding by changing the square bracket control\n      // characters back to their literals. This is fine by the server, and\n      // makes these parameter strings easier to read.\n      .replace(/%5B/g, '[').replace(/%5D/g, ']');\n  },\n\n  /**\n   * Outputs a new function with interpolated object property values.\n   * Use like so:\n   *   var fn = makeURLInterpolator('some/url/{param1}/{param2}');\n   *   fn({ param1: 123, param2: 456 }); // => 'some/url/123/456'\n   */\n  makeURLInterpolator: (function() {\n    var rc = {\n      '\\n': '\\\\n', '\\\"': '\\\\\\\"',\n      '\\u2028': '\\\\u2028', '\\u2029': '\\\\u2029',\n    };\n    return function makeURLInterpolator(str) {\n      var cleanString = str.replace(/[\"\\n\\r\\u2028\\u2029]/g, function($0) {\n        return rc[$0];\n      });\n      return function(outputs) {\n        return cleanString.replace(/\\{([\\s\\S]+?)\\}/g, function($0, $1) {\n          return encodeURIComponent(outputs[$1] || '');\n        });\n      };\n    };\n  }()),\n\n  /**\n   * Return the data argument from a list of arguments\n   */\n  getDataFromArgs: function(args) {\n    if (args.length < 1 || !isPlainObject(args[0])) {\n      return {};\n    }\n\n    if (!utils.isOptionsHash(args[0])) {\n      return args.shift();\n    }\n\n    var argKeys = Object.keys(args[0]);\n\n    var optionKeysInArgs = argKeys.filter(function(key) {\n      return OPTIONS_KEYS.indexOf(key) > -1;\n    });\n\n    // In some cases options may be the provided as the first argument.\n    // Here we're detecting a case where there are two distinct arguments\n    // (the first being args and the second options) and with known\n    // option keys in the first so that we can warn the user about it.\n    if (optionKeysInArgs.length > 0 && optionKeysInArgs.length !== argKeys.length) {\n      emitWarning(\n        'Options found in arguments (' + optionKeysInArgs.join(', ') + '). Did you mean to pass an options ' +\n        'object? See https://github.com/stripe/stripe-node/wiki/Passing-Options.'\n      );\n    }\n\n    return {};\n  },\n\n  /**\n   * Return the options hash from a list of arguments\n   */\n  getOptionsFromArgs: function(args) {\n    var opts = {\n      auth: null,\n      headers: {},\n    };\n    if (args.length > 0) {\n      var arg = args[args.length - 1];\n      if (utils.isAuthKey(arg)) {\n        opts.auth = args.pop();\n      } else if (utils.isOptionsHash(arg)) {\n        var params = args.pop();\n\n        var extraKeys = Object.keys(params).filter(function(key) {\n          return OPTIONS_KEYS.indexOf(key) == -1;\n        });\n\n        if (extraKeys.length) {\n          emitWarning('Invalid options found (' + extraKeys.join(', ') + '); ignoring.');\n        }\n\n        if (params.api_key) {\n          opts.auth = params.api_key;\n        }\n        if (params.idempotency_key) {\n          opts.headers['Idempotency-Key'] = params.idempotency_key;\n        }\n        if (params.stripe_account) {\n          opts.headers['Stripe-Account'] = params.stripe_account;\n        }\n        if (params.stripe_version) {\n          opts.headers['Stripe-Version'] = params.stripe_version;\n        }\n      }\n    }\n    return opts;\n  },\n\n  /**\n   * Provide simple \"Class\" extension mechanism\n   */\n  protoExtend: function(sub) {\n    var Super = this;\n    var Constructor = hasOwn.call(sub, 'constructor') ? sub.constructor : function() {\n      Super.apply(this, arguments);\n    };\n\n    // This initialization logic is somewhat sensitive to be compatible with\n    // divergent JS implementations like the one found in Qt. See here for more\n    // context:\n    //\n    // https://github.com/stripe/stripe-node/pull/334\n    Object.assign(Constructor, Super);\n    Constructor.prototype = Object.create(Super.prototype);\n    Object.assign(Constructor.prototype, sub);\n\n    return Constructor;\n  },\n\n  /**\n  * Secure compare, from https://github.com/freewil/scmp\n  */\n  secureCompare: function(a, b) {\n    a = Buffer.from(a);\n    b = Buffer.from(b);\n\n    // return early here if buffer lengths are not equal since timingSafeEqual\n    // will throw if buffer lengths are not equal\n    if (a.length !== b.length) {\n      return false;\n    }\n\n    // use crypto.timingSafeEqual if available (since Node.js v6.6.0),\n    // otherwise use our own scmp-internal function.\n    if (crypto.timingSafeEqual) {\n      return crypto.timingSafeEqual(a, b);\n    }\n\n    var len = a.length;\n    var result = 0;\n\n    for (var i = 0; i < len; ++i) {\n      result |= a[i] ^ b[i];\n    }\n    return result === 0;\n  },\n\n  /**\n  * Remove empty values from an object\n  */\n  removeEmpty: function(obj) {\n    if (typeof obj !== 'object') {\n      throw new Error('Argument must be an object');\n    }\n\n    Object.keys(obj).forEach(function(key) {\n      if (obj[key] === null || obj[key] === undefined) {\n        delete obj[key];\n      }\n    });\n\n    return obj;\n  },\n\n  /**\n  * Determine if file data is a derivative of EventEmitter class.\n  * https://nodejs.org/api/events.html#events_events\n  */\n  checkForStream: function (obj) {\n    if (obj.file && obj.file.data) {\n      return obj.file.data instanceof EventEmitter;\n    }\n    return false;\n  },\n\n  callbackifyPromiseWithTimeout: function(promise, callback) {\n    if (callback) {\n      // Ensure callback is called outside of promise stack.\n      return promise.then(function(res) {\n        setTimeout(function() { callback(null, res) }, 0);\n      }, function(err) {\n        setTimeout(function() { callback(err, null); }, 0);\n      });\n    }\n\n    return promise;\n  },\n\n  /**\n   * Allow for special capitalization cases (such as OAuth)\n   */\n  pascalToCamelCase: function(name) {\n    if (name === 'OAuth') {\n      return 'oauth';\n    } else {\n      return name[0].toLowerCase() + name.substring(1);\n    }\n  },\n\n  emitWarning: emitWarning,\n\n  /**\n   * Node's built in `exec` function sometimes throws outright,\n   * and sometimes has a callback with an error,\n   * depending on the type of error.\n   *\n   * This unifies that interface.\n   */\n  safeExec: function safeExec(cmd, cb) {\n    try {\n      utils._exec(cmd, cb);\n    } catch (e) {\n      cb(e, null);\n    }\n  },\n\n  // For mocking in tests.\n  _exec: exec,\n\n  isObject: function isObject(obj) {\n    var type = typeof obj;\n    return (type === 'function' || type === 'object') && !!obj;\n  },\n\n  // For use in multipart requests\n  flattenAndStringify: function flattenAndStringify(data) {\n    var result = {};\n\n    function step(obj, prevKey) {\n      Object.keys(obj).forEach(function (key) {\n        var value = obj[key];\n\n        var newKey = prevKey ? `${prevKey}[${key}]` : key;\n\n        if (utils.isObject(value)) {\n          if (!Buffer.isBuffer(value) && !value.hasOwnProperty('data')) {\n            // Non-buffer non-file Objects are recursively flattened\n            return step(value, newKey);\n          } else {\n            // Buffers and file objects are stored without modification\n            result[newKey] = value;\n          }\n        } else {\n          // Primitives are converted to strings\n          result[newKey] = String(value);\n        }\n      })\n    }\n\n    step(data);\n\n    return result;\n  },\n};\n\nfunction emitWarning(warning) {\n  if (typeof process.emitWarning !== 'function') {\n    return console.warn('Stripe: ' + warning); /* eslint-disable-line no-console */\n  }\n\n  return process.emitWarning(warning, 'Stripe');\n}\n"]},"metadata":{},"sourceType":"script"}